generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

enum QuestionType {
    TRUE_FALSE
    SINGLE_CHOICE
    MULTIPLE_CHOICE
}

enum RoomStatus {
    WAITING
    IN_PROGRESS
    FINISHED
}

model User {
    id        String     @id @default(uuid()) @db.Char(36)
    username  String     @unique @db.VarChar(255)
    password  String     @db.VarChar(255)
    createdAt DateTime   @default(now()) @map("created_at")
    updatedAt DateTime   @updatedAt @map("updated_at")
    questions Question[]
    rooms     Room[]

    @@map("users")
}

model Club {
    id        String   @id @default(uuid()) @db.Char(36)
    name      String   @db.VarChar(255)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")
    players   Player[]

    @@map("clubs")
}

model Room {
    id                   String     @id @default(uuid()) @db.Char(36)
    userId               String     @map("user_id") @db.Char(36)
    code                 String     @unique @db.VarChar(100)
    name                 String     @db.VarChar(255)
    status               RoomStatus @default(WAITING)
    currentQuestionIndex Int        @default(0) @map("current_question_index")
    startedAt            DateTime?  @map("started_at")
    createdAt            DateTime   @default(now()) @map("created_at")
    updatedAt            DateTime   @updatedAt @map("updated_at")

    user          User           @relation(fields: [userId], references: [id])
    players       Player[]
    questions     Question[]
    playerAnswers PlayerAnswer[]

    @@map("rooms")
}

model Player {
    id        String    @id @default(uuid()) @db.Char(36)
    fullName  String    @map("full_name") @db.VarChar(255)
    roomId    String    @map("room_id") @db.Char(36)
    clubId    String    @map("club_id") @db.Char(36)
    score     Int       @default(0)
    createdAt DateTime  @default(now()) @map("created_at")
    endAt     DateTime? @map("end_at")
    updatedAt DateTime  @updatedAt @map("updated_at")

    club          Club           @relation(fields: [clubId], references: [id])
    room          Room           @relation(fields: [roomId], references: [id])
    playerAnswers PlayerAnswer[]

    @@map("players")
}

model Question {
    id           String       @id @default(uuid()) @db.Char(36)
    roomId       String       @map("room_id") @db.Char(36)
    question     String       @db.Text
    type         QuestionType @default(SINGLE_CHOICE)
    timeQuestion Int          @default(20) @map("time_question")
    score        Int          @default(20)
    userId       String       @map("user_id") @db.Char(36)
    createdAt    DateTime     @default(now()) @map("created_at")
    updatedAt    DateTime     @updatedAt @map("updated_at")

    answers       Answer[]
    room          Room           @relation(fields: [roomId], references: [id])
    playerAnswers PlayerAnswer[]
    user          User           @relation(fields: [userId], references: [id])

    @@map("questions")
}

model Answer {
    id         String   @id @default(uuid()) @db.Char(36)
    questionId String   @map("question_id") @db.Char(36)
    answer     String   @db.Text
    isCorrect  Boolean  @default(false) @map("is_correct")
    createdAt  DateTime @default(now()) @map("created_at")
    updatedAt  DateTime @updatedAt @map("updated_at")

    question      Question       @relation(fields: [questionId], references: [id])
    playerAnswers PlayerAnswer[]

    @@map("answers")
}

model PlayerAnswer {
    id         String   @id @default(uuid()) @db.Char(36)
    playerId   String   @map("player_id") @db.Char(36)
    questionId String   @map("question_id") @db.Char(36)
    answerId   String   @map("answer_id") @db.Char(36)
    roomId     String   @map("room_id") @db.Char(36)
    score      Int      @default(0)
    answeredAt DateTime @default(now()) @map("answered_at")
    createdAt  DateTime @default(now()) @map("created_at")

    player   Player   @relation(fields: [playerId], references: [id])
    question Question @relation(fields: [questionId], references: [id])
    answer   Answer   @relation(fields: [answerId], references: [id])
    room     Room     @relation(fields: [roomId], references: [id])

    @@unique([playerId, questionId])
    @@map("player_answers")
}
